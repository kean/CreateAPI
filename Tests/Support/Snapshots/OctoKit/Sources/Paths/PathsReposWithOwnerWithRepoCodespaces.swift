// Generated by Create API
// https://github.com/CreateAPI/CreateAPI

import Foundation
import Get
import HTTPHeaders
import URLQueryEncoder

extension Paths.Repos.WithOwner.WithRepo {
    public var codespaces: Codespaces {
        Codespaces(path: path + "/codespaces")
    }

    public struct Codespaces {
        /// Path: `/repos/{owner}/{repo}/codespaces`
        public let path: String

        /// List codespaces in a repository for the authenticated user
        ///
        /// Lists the codespaces associated to a specified repository and the authenticated user.
        /// 
        /// You must authenticate using an access token with the `codespace` scope to use this endpoint.
        ///
        /// [API method documentation](https://docs.github.com/rest/reference/codespaces#list-codespaces-in-a-repository-for-the-authenticated-user)
        public func get(perPage: Int? = nil, page: Int? = nil) -> Request<GetResponse> {
            Request(method: "GET", url: path, query: makeGetQuery(perPage, page), id: "codespaces/list-in-repository-for-authenticated-user")
        }

        public struct GetResponse: Decodable {
            public var totalCount: Int
            public var codespaces: [OctoKit.Codespace]

            public init(totalCount: Int, codespaces: [OctoKit.Codespace]) {
                self.totalCount = totalCount
                self.codespaces = codespaces
            }

            public init(from decoder: Decoder) throws {
                let values = try decoder.container(keyedBy: StringCodingKey.self)
                self.totalCount = try values.decode(Int.self, forKey: "total_count")
                self.codespaces = try values.decode([OctoKit.Codespace].self, forKey: "codespaces")
            }
        }

        private func makeGetQuery(_ perPage: Int?, _ page: Int?) -> [(String, String?)] {
            let encoder = URLQueryEncoder()
            encoder.encode(perPage, forKey: "per_page")
            encoder.encode(page, forKey: "page")
            return encoder.items
        }

        /// Create a codespace in a repository
        ///
        /// Creates a codespace owned by the authenticated user in the specified repository.
        /// 
        /// You must authenticate using an access token with the `codespace` scope to use this endpoint.
        ///
        /// [API method documentation](https://docs.github.com/rest/reference/codespaces#create-a-codespace-in-a-repository)
        public func post(_ body: PostRequest) -> Request<OctoKit.Codespace> {
            Request(method: "POST", url: path, body: body, id: "codespaces/create-with-repo-for-authenticated-user")
        }

        public struct PostRequest: Encodable {
            /// Git ref (typically a branch name) for this codespace
            public var ref: String?
            /// Location for this codespace
            public var location: String
            /// Machine type to use for this codespace
            public var machine: String?
            /// Working directory for this codespace
            public var workingDirectory: String?
            /// Time in minutes before codespace stops from inactivity
            public var idleTimeoutMinutes: Int?

            public init(ref: String? = nil, location: String, machine: String? = nil, workingDirectory: String? = nil, idleTimeoutMinutes: Int? = nil) {
                self.ref = ref
                self.location = location
                self.machine = machine
                self.workingDirectory = workingDirectory
                self.idleTimeoutMinutes = idleTimeoutMinutes
            }

            public func encode(to encoder: Encoder) throws {
                var values = encoder.container(keyedBy: StringCodingKey.self)
                try values.encodeIfPresent(ref, forKey: "ref")
                try values.encode(location, forKey: "location")
                try values.encodeIfPresent(machine, forKey: "machine")
                try values.encodeIfPresent(workingDirectory, forKey: "working_directory")
                try values.encodeIfPresent(idleTimeoutMinutes, forKey: "idle_timeout_minutes")
            }
        }
    }
}
